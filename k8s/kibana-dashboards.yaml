apiVersion: v1
kind: ConfigMap
metadata:
  name: kibana-dashboards
  namespace: default
data:
  setup-dashboards.sh: |
    #!/bin/bash
    
    # Wait for Kibana to be ready
    until curl -s http://kibana:5601/api/status | grep -q '"overall":{"level":"available"'; do
      echo "Waiting for Kibana to be ready..."
      sleep 10
    done
    
    echo "Kibana is ready, setting up dashboards..."
    
    # Create index pattern for hellogithubactions
    curl -X POST "http://kibana:5601/api/saved_objects/index-pattern/hellogithubactions-*" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "hellogithubactions-*",
        "timeFieldName": "@timestamp",
        "fields": "[{\"name\":\"@timestamp\",\"type\":\"date\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"level\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"logger\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"message\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":false},{\"name\":\"thread\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"kubernetes.pod\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"kubernetes.namespace\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"kubernetes.container\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"mdc.correlationId\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"mdc.responseTime\",\"type\":\"number\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"mdc.method\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"mdc.uri\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"mdc.status\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":true},{\"name\":\"service.name\",\"type\":\"string\",\"searchable\":true,\"aggregatable\":true}]"
      }
    }'
    
    # 4.1 Overview Dashboard
    curl -X POST "http://kibana:5601/api/saved_objects/dashboard/overview-dashboard" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "HelloGithubActions - Overview Dashboard",
        "type": "dashboard",
        "description": "Overview dashboard showing log volume, levels, errors and response times",
        "timeRestore": true,
        "timeTo": "now",
        "timeFrom": "now-24h",
        "refreshInterval": {
          "display": "30 seconds",
          "pause": false,
          "value": 30000
        },
        "panelsJSON": "[{\"version\":\"8.11.0\",\"gridData\":{\"x\":0,\"y\":0,\"w\":24,\"h\":15,\"i\":\"1\"},\"panelIndex\":\"1\",\"embeddableConfig\":{\"title\":\"Log Volume Over Time\"},\"panelRefName\":\"panel_1\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":24,\"y\":0,\"w\":24,\"h\":15,\"i\":\"2\"},\"panelIndex\":\"2\",\"embeddableConfig\":{\"title\":\"Log Levels Distribution\"},\"panelRefName\":\"panel_2\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":0,\"y\":15,\"w\":48,\"h\":15,\"i\":\"3\"},\"panelIndex\":\"3\",\"embeddableConfig\":{\"title\":\"Top Error Messages\"},\"panelRefName\":\"panel_3\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":0,\"y\":30,\"w\":48,\"h\":15,\"i\":\"4\"},\"panelIndex\":\"4\",\"embeddableConfig\":{\"title\":\"Response Time Percentiles\"},\"panelRefName\":\"panel_4\"}]",
        "optionsJSON": "{\"useMargins\":true,\"syncColors\":false,\"hidePanelTitles\":false}"
      },
      "references": [
        {
          "name": "panel_1",
          "type": "visualization",
          "id": "log-volume-timeline"
        },
        {
          "name": "panel_2", 
          "type": "visualization",
          "id": "log-levels-pie"
        },
        {
          "name": "panel_3",
          "type": "visualization", 
          "id": "top-error-messages"
        },
        {
          "name": "panel_4",
          "type": "visualization",
          "id": "response-time-histogram"
        }
      ]
    }'
    
    # Create visualizations for Overview Dashboard
    
    # Log Volume Over Time (Line Chart)
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/log-volume-timeline" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Log Volume Over Time",
        "type": "line",
        "description": "Line chart showing log volume over time",
        "visState": "{\"title\":\"Log Volume Over Time\",\"type\":\"line\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"date_histogram\",\"params\":{\"field\":\"@timestamp\",\"interval\":\"auto\",\"min_doc_count\":1},\"schema\":\"segment\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"match_all\":{}},\"filter\":[]}"
        }
      }
    }'
    
    # Log Levels Distribution (Pie Chart)
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/log-levels-pie" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Log Levels Distribution",
        "type": "pie",
        "description": "Pie chart showing distribution of log levels",
        "visState": "{\"title\":\"Log Levels Distribution\",\"type\":\"pie\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"level\",\"size\":10,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"segment\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"match_all\":{}},\"filter\":[]}"
        }
      }
    }'
    
    # Top Error Messages (Data Table)
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/top-error-messages" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Top Error Messages",
        "type": "table",
        "description": "Data table showing top error messages",
        "visState": "{\"title\":\"Top Error Messages\",\"type\":\"table\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"message.keyword\",\"size\":20,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"bucket\"}]}",
        "uiStateJSON": "{\"vis\":{\"params\":{\"sort\":{\"columnIndex\":null,\"direction\":null}}}}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"must\":[{\"term\":{\"level\":\"ERROR\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    # Response Time Percentiles (Histogram)
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/response-time-histogram" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Response Time Percentiles",
        "type": "histogram",
        "description": "Histogram showing response time percentiles",
        "visState": "{\"title\":\"Response Time Percentiles\",\"type\":\"histogram\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"percentiles\",\"params\":{\"field\":\"mdc.responseTime\",\"percents\":[50,90,95,99]},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"date_histogram\",\"params\":{\"field\":\"@timestamp\",\"interval\":\"auto\",\"min_doc_count\":1},\"schema\":\"segment\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"must\":[{\"exists\":{\"field\":\"mdc.responseTime\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    echo "Overview Dashboard created successfully"
    
    # 4.2 Application Monitoring Dashboard
    curl -X POST "http://kibana:5601/api/saved_objects/dashboard/application-monitoring-dashboard" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "HelloGithubActions - Application Monitoring",
        "type": "dashboard",
        "description": "Application monitoring showing requests, errors, response times, and JVM metrics",
        "timeRestore": true,
        "timeTo": "now",
        "timeFrom": "now-24h",
        "refreshInterval": {
          "display": "30 seconds",
          "pause": false,
          "value": 30000
        },
        "panelsJSON": "[{\"version\":\"8.11.0\",\"gridData\":{\"x\":0,\"y\":0,\"w\":24,\"h\":15,\"i\":\"1\"},\"panelIndex\":\"1\",\"embeddableConfig\":{\"title\":\"Request Count by Endpoint\"},\"panelRefName\":\"panel_1\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":24,\"y\":0,\"w\":24,\"h\":15,\"i\":\"2\"},\"panelIndex\":\"2\",\"embeddableConfig\":{\"title\":\"Error Rate Percentage\"},\"panelRefName\":\"panel_2\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":0,\"y\":15,\"w\":24,\"h\":15,\"i\":\"3\"},\"panelIndex\":\"3\",\"embeddableConfig\":{\"title\":\"Average Response Time\"},\"panelRefName\":\"panel_3\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":24,\"y\":15,\"w\":24,\"h\":15,\"i\":\"4\"},\"panelIndex\":\"4\",\"embeddableConfig\":{\"title\":\"JVM Memory Usage Trends\"},\"panelRefName\":\"panel_4\"}]",
        "optionsJSON": "{\"useMargins\":true,\"syncColors\":false,\"hidePanelTitles\":false}"
      },
      "references": [
        {
          "name": "panel_1",
          "type": "visualization",
          "id": "request-count-by-endpoint"
        },
        {
          "name": "panel_2",
          "type": "visualization",
          "id": "error-rate-percentage"
        },
        {
          "name": "panel_3",
          "type": "visualization",
          "id": "average-response-time"
        },
        {
          "name": "panel_4",
          "type": "visualization",
          "id": "jvm-memory-trends"
        }
      ]
    }'
    
    # Request Count by Endpoint
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/request-count-by-endpoint" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Request Count by Endpoint",
        "type": "horizontal_bar",
        "description": "Horizontal bar chart showing request count by endpoint",
        "visState": "{\"title\":\"Request Count by Endpoint\",\"type\":\"horizontal_bar\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"mdc.uri\",\"size\":20,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"segment\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"must\":[{\"exists\":{\"field\":\"mdc.uri\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    # Error Rate Percentage
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/error-rate-percentage" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Error Rate Percentage",
        "type": "gauge",
        "description": "Gauge showing error rate percentage",
        "visState": "{\"title\":\"Error Rate Percentage\",\"type\":\"gauge\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"filters\",\"params\":{\"filters\":[{\"input\":{\"query\":\"level:ERROR\"},\"label\":\"Errors\"},{\"input\":{\"query\":\"*\"},\"label\":\"Total\"}]},\"schema\":\"group\"}]}",
        "uiStateJSON": "{\"vis\":{\"defaultColors\":{\"0 - 5\":\"rgb(0,104,55)\",\"5 - 10\":\"rgb(255,255,190)\",\"10 - 100\":\"rgb(165,0,38)\"}}}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"match_all\":{}},\"filter\":[]}"
        }
      }
    }'
    
    # Average Response Time
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/average-response-time" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Average Response Time",
        "type": "line",
        "description": "Line chart showing average response time over time",
        "visState": "{\"title\":\"Average Response Time\",\"type\":\"line\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"avg\",\"params\":{\"field\":\"mdc.responseTime\"},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"date_histogram\",\"params\":{\"field\":\"@timestamp\",\"interval\":\"auto\",\"min_doc_count\":1},\"schema\":\"segment\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"must\":[{\"exists\":{\"field\":\"mdc.responseTime\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    # JVM Memory Usage Trends (using logger field as proxy)
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/jvm-memory-trends" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "JVM Memory Usage Trends",
        "type": "area",
        "description": "Area chart showing JVM-related log events over time",
        "visState": "{\"title\":\"JVM Memory Usage Trends\",\"type\":\"area\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"date_histogram\",\"params\":{\"field\":\"@timestamp\",\"interval\":\"auto\",\"min_doc_count\":1},\"schema\":\"segment\"},{\"id\":\"3\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"logger\",\"size\":5,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"group\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"should\":[{\"wildcard\":{\"message\":\"*memory*\"}},{\"wildcard\":{\"message\":\"*gc*\"}},{\"wildcard\":{\"message\":\"*heap*\"}},{\"wildcard\":{\"logger\":\"*jvm*\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    echo "Application Monitoring Dashboard created successfully"
    
    # 4.3 Error Analysis Dashboard
    curl -X POST "http://kibana:5601/api/saved_objects/dashboard/error-analysis-dashboard" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "HelloGithubActions - Error Analysis",
        "type": "dashboard",
        "description": "Error analysis dashboard showing recent errors, stack traces, affected pods, and correlation analysis",
        "timeRestore": true,
        "timeTo": "now",
        "timeFrom": "now-24h",
        "refreshInterval": {
          "display": "30 seconds",
          "pause": false,
          "value": 30000
        },
        "panelsJSON": "[{\"version\":\"8.11.0\",\"gridData\":{\"x\":0,\"y\":0,\"w\":48,\"h\":15,\"i\":\"1\"},\"panelIndex\":\"1\",\"embeddableConfig\":{\"title\":\"Recent Errors Timeline\"},\"panelRefName\":\"panel_1\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":0,\"y\":15,\"w\":24,\"h\":20,\"i\":\"2\"},\"panelIndex\":\"2\",\"embeddableConfig\":{\"title\":\"Error Stack Trace Viewer\"},\"panelRefName\":\"panel_2\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":24,\"y\":15,\"w\":24,\"h\":10,\"i\":\"3\"},\"panelIndex\":\"3\",\"embeddableConfig\":{\"title\":\"Affected Pods/Containers\"},\"panelRefName\":\"panel_3\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":24,\"y\":25,\"w\":24,\"h\":10,\"i\":\"4\"},\"panelIndex\":\"4\",\"embeddableConfig\":{\"title\":\"Error Correlation Analysis\"},\"panelRefName\":\"panel_4\"}]",
        "optionsJSON": "{\"useMargins\":true,\"syncColors\":false,\"hidePanelTitles\":false}"
      },
      "references": [
        {
          "name": "panel_1",
          "type": "visualization",
          "id": "recent-errors-timeline"
        },
        {
          "name": "panel_2",
          "type": "visualization",
          "id": "error-stack-trace-viewer"
        },
        {
          "name": "panel_3",
          "type": "visualization",
          "id": "affected-pods-containers"
        },
        {
          "name": "panel_4",
          "type": "visualization",
          "id": "error-correlation-analysis"
        }
      ]
    }'
    
    # Recent Errors Timeline
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/recent-errors-timeline" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Recent Errors Timeline",
        "type": "line",
        "description": "Timeline showing recent errors over time",
        "visState": "{\"title\":\"Recent Errors Timeline\",\"type\":\"line\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"date_histogram\",\"params\":{\"field\":\"@timestamp\",\"interval\":\"auto\",\"min_doc_count\":1},\"schema\":\"segment\"},{\"id\":\"3\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"level\",\"size\":5,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"group\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"should\":[{\"term\":{\"level\":\"ERROR\"}},{\"term\":{\"level\":\"WARN\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    # Error Stack Trace Viewer
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/error-stack-trace-viewer" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Error Stack Trace Viewer",
        "type": "table",
        "description": "Table showing error messages and details",
        "visState": "{\"title\":\"Error Stack Trace Viewer\",\"type\":\"table\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"@timestamp\",\"size\":50,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"bucket\"},{\"id\":\"3\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"logger\",\"size\":10,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"bucket\"},{\"id\":\"4\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"message.keyword\",\"size\":20,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"bucket\"}]}",
        "uiStateJSON": "{\"vis\":{\"params\":{\"sort\":{\"columnIndex\":0,\"direction\":\"desc\"}}}}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"term\":{\"level\":\"ERROR\"}},\"filter\":[]}"
        }
      }
    }'
    
    # Affected Pods/Containers
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/affected-pods-containers" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Affected Pods/Containers",
        "type": "pie",
        "description": "Pie chart showing errors by pod/container",
        "visState": "{\"title\":\"Affected Pods/Containers\",\"type\":\"pie\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"kubernetes.pod\",\"size\":10,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"segment\"},{\"id\":\"3\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"kubernetes.container\",\"size\":5,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"segment\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"should\":[{\"term\":{\"level\":\"ERROR\"}},{\"term\":{\"level\":\"WARN\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    # Error Correlation Analysis
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/error-correlation-analysis" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Error Correlation Analysis",
        "type": "heatmap",
        "description": "Heatmap showing error correlation by correlation ID and time",
        "visState": "{\"title\":\"Error Correlation Analysis\",\"type\":\"heatmap\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"date_histogram\",\"params\":{\"field\":\"@timestamp\",\"interval\":\"auto\",\"min_doc_count\":1},\"schema\":\"segment\"},{\"id\":\"3\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"mdc.correlationId\",\"size\":20,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"group\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"must\":[{\"term\":{\"level\":\"ERROR\"}},{\"exists\":{\"field\":\"mdc.correlationId\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    echo "Error Analysis Dashboard created successfully"
    
    # 4.4 Security Dashboard
    curl -X POST "http://kibana:5601/api/saved_objects/dashboard/security-dashboard" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "HelloGithubActions - Security Dashboard",
        "type": "dashboard",
        "description": "Security monitoring dashboard showing authentication attempts, access patterns, and security events",
        "timeRestore": true,
        "timeTo": "now",
        "timeFrom": "now-24h",
        "refreshInterval": {
          "display": "30 seconds",
          "pause": false,
          "value": 30000
        },
        "panelsJSON": "[{\"version\":\"8.11.0\",\"gridData\":{\"x\":0,\"y\":0,\"w\":24,\"h\":15,\"i\":\"1\"},\"panelIndex\":\"1\",\"embeddableConfig\":{\"title\":\"Failed Authentication Attempts\"},\"panelRefName\":\"panel_1\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":24,\"y\":0,\"w\":24,\"h\":15,\"i\":\"2\"},\"panelIndex\":\"2\",\"embeddableConfig\":{\"title\":\"Unusual Access Patterns\"},\"panelRefName\":\"panel_2\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":0,\"y\":15,\"w\":24,\"h\":15,\"i\":\"3\"},\"panelIndex\":\"3\",\"embeddableConfig\":{\"title\":\"Security-related Log Events\"},\"panelRefName\":\"panel_3\"},{\"version\":\"8.11.0\",\"gridData\":{\"x\":24,\"y\":15,\"w\":24,\"h\":15,\"i\":\"4\"},\"panelIndex\":\"4\",\"embeddableConfig\":{\"title\":\"Geographic Access Distribution\"},\"panelRefName\":\"panel_4\"}]",
        "optionsJSON": "{\"useMargins\":true,\"syncColors\":false,\"hidePanelTitles\":false}"
      },
      "references": [
        {
          "name": "panel_1",
          "type": "visualization",
          "id": "failed-auth-attempts"
        },
        {
          "name": "panel_2",
          "type": "visualization",
          "id": "unusual-access-patterns"
        },
        {
          "name": "panel_3",
          "type": "visualization",
          "id": "security-log-events"
        },
        {
          "name": "panel_4",
          "type": "visualization",
          "id": "geographic-access-distribution"
        }
      ]
    }'
    
    # Failed Authentication Attempts
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/failed-auth-attempts" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Failed Authentication Attempts",
        "type": "line",
        "description": "Timeline showing failed authentication attempts",
        "visState": "{\"title\":\"Failed Authentication Attempts\",\"type\":\"line\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"date_histogram\",\"params\":{\"field\":\"@timestamp\",\"interval\":\"auto\",\"min_doc_count\":1},\"schema\":\"segment\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"should\":[{\"wildcard\":{\"message\":\"*authentication*failed*\"}},{\"wildcard\":{\"message\":\"*login*failed*\"}},{\"wildcard\":{\"message\":\"*unauthorized*\"}},{\"term\":{\"mdc.status\":\"401\"}},{\"term\":{\"mdc.status\":\"403\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    # Unusual Access Patterns
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/unusual-access-patterns" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Unusual Access Patterns",
        "type": "table",
        "description": "Table showing unusual access patterns and suspicious activities",
        "visState": "{\"title\":\"Unusual Access Patterns\",\"type\":\"table\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"mdc.remoteAddr\",\"size\":20,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"bucket\"},{\"id\":\"3\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"mdc.userAgent\",\"size\":10,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"bucket\"}]}",
        "uiStateJSON": "{\"vis\":{\"params\":{\"sort\":{\"columnIndex\":0,\"direction\":\"desc\"}}}}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"should\":[{\"range\":{\"mdc.responseTime\":{\"gte\":5000}}},{\"term\":{\"mdc.status\":\"429\"}},{\"wildcard\":{\"mdc.userAgent\":\"*bot*\"}},{\"wildcard\":{\"mdc.userAgent\":\"*crawler*\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    # Security-related Log Events
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/security-log-events" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Security-related Log Events",
        "type": "horizontal_bar",
        "description": "Bar chart showing security-related log events by category",
        "visState": "{\"title\":\"Security-related Log Events\",\"type\":\"horizontal_bar\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"logger\",\"size\":15,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"segment\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"should\":[{\"wildcard\":{\"logger\":\"*security*\"}},{\"wildcard\":{\"logger\":\"*auth*\"}},{\"wildcard\":{\"message\":\"*security*\"}},{\"wildcard\":{\"message\":\"*authentication*\"}},{\"wildcard\":{\"message\":\"*authorization*\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    # Geographic Access Distribution
    curl -X POST "http://kibana:5601/api/saved_objects/visualization/geographic-access-distribution" \
    -H "Content-Type: application/json" \
    -H "kbn-xsrf: true" \
    -d '{
      "attributes": {
        "title": "Geographic Access Distribution",
        "type": "pie",
        "description": "Pie chart showing access distribution by IP address/location",
        "visState": "{\"title\":\"Geographic Access Distribution\",\"type\":\"pie\",\"aggs\":[{\"id\":\"1\",\"enabled\":true,\"type\":\"count\",\"params\":{},\"schema\":\"metric\"},{\"id\":\"2\",\"enabled\":true,\"type\":\"terms\",\"params\":{\"field\":\"mdc.remoteAddr\",\"size\":10,\"order\":\"desc\",\"orderBy\":\"1\"},\"schema\":\"segment\"}]}",
        "uiStateJSON": "{}",
        "kibanaSavedObjectMeta": {
          "searchSourceJSON": "{\"index\":\"hellogithubactions-*\",\"query\":{\"bool\":{\"must\":[{\"exists\":{\"field\":\"mdc.remoteAddr\"}}]}},\"filter\":[]}"
        }
      }
    }'
    
    echo "Security Dashboard created successfully"
    
    echo "üéâ All dashboards created successfully!"
    echo "üìä Available dashboards:"
    echo "  - HelloGithubActions - Overview Dashboard"
    echo "  - HelloGithubActions - Application Monitoring"
    echo "  - HelloGithubActions - Error Analysis" 
    echo "  - HelloGithubActions - Security Dashboard"
    echo ""
    echo "üåê Access Kibana at: http://localhost:5601"
    echo "üìã Index pattern: hellogithubactions-*"